\documentclass[12pt]{scrartcl}
\usepackage{graphicx}
%\usepackage[ngerman]{babel}
\usepackage{natbib}
\usepackage{amsmath}
\usepackage{amstext}
\usepackage{color}
\usepackage{braket}
\usepackage{lscape}
\usepackage{standalone}
\standaloneconfig{mode=buildnew}
\usepackage{tikz}
%\usepackage{pgfplots}
%\usepackage{xcolor}
\usetikzlibrary{positioning,shapes.geometric}
%\usetikzlibrary{trees}

\begin{document}
\author{Florian Frei}
\title{The Computational Bottleneck of Ab-initio Molecular Dynamics And Possible Solutions}

\maketitle

\newpage

\tableofcontents

\newpage

\section{Derivation of ab-initio molecular dynamics}
This work is mostly based on the book of Domminik Marx and J\"urg Hutter \cite{marx2009ab} which is based on their published article in 2000, in which they did significant work in summarizing and structuring the molecular dynamics field with a categorical derivation and complete references on works done previously in this field. To understand where the computational bottleneck is coming from and why it is there one requires the tools to derive the equation which leads to it. Thus one should start namely with the Lagrangian and Hamilton formalism. These are essential that one does not forget the equivalence of these two views. 
%For the advanced reader it is recommended to skip these sections and start with derivation of classical molecular dynamics section \ref{sec:cmd}.
\subsection{Lagrangian of a system}
The Lagrangian is defined by
\begin{align}
\mathcal{L}(\mathbf{q},\dot{\mathbf{q}}) &= \mathcal{T}(\mathbf{q},\dot{\mathbf{q}}) - \mathcal{V}(\mathbf{q},\dot{\mathbf{q}})\label{def:lagrangian}\\
\intertext{with kinetic energy $\mathcal{T}$ and potential energy $\mathcal{V}$. In case of Born-Oppenheimer view the kinetic energy is dominated by nuclear motion and the potential energy is solely given by the electronic energy. Thus an educated guess requires that the Lagrangian is of the following form:}
\mathcal{L}^{BO}(\mathbf{R}_I,\dot{\mathbf{R}}_I) &= \frac{1}{2}\sum_{I}M_I\dot{\mathbf{R}}_I^2 - \mathcal{V}(\{\mathbf{R}_I\},D)\label{lagrangian:BO}\\
\intertext{where the potential is evaluated at the ground state $D$ which minimizes the electronic energy for a given nuclear configuration $\{R_I\}$. The equations of motion of the system is then given by the Euler-Lagrange equation:}
\frac{d}{dt}\frac{\partial \mathcal{L}}{\partial \dot{\mathbf{q}}} &=\frac{\partial \mathcal{L}}{\partial \mathbf{q}}\label{eq:euler-lagrange}
\end{align}

Inserting \ref{lagrangian:BO} into \ref{eq:euler-lagrange} and looking at each individual term results in:
\begin{align*}
\frac{\partial \mathcal{L}^{BO}}{\partial \mathbf{R}_I} &= - \frac{\partial \mathcal{V}(\{\mathbf{R}_I\},D)}{\partial \mathbf{R}_I}\\
\frac{\partial \mathcal{L}^{BO}}{\partial \dot{\mathbf{R}}_I} &= \frac{1}{2}\cdot 2 M_I \dot{\mathbf{R}}_I\\
\frac{d}{dt} \frac{\partial \mathcal{L}^{BO}}{\partial \dot{\mathbf{R}}_I} &= M_I \ddot{\mathbf{R}}_I\\
\implies M_I \ddot{\mathbf{R}}_I &= - \frac{\partial \mathcal{V}(\{\mathbf{R}_I\},D)}{\partial \mathbf{R}_I}\\
\iff M_I \ddot{\mathbf{R}}_I &= - \nabla_I \mathcal{V}(\{\mathbf{R}_I\},D)
\end{align*}
Therefore before integrating the nuclear motion one has to evaluate the potential energy which leads to search for the ground state $D$ for a given nuclear configuration.

\subsection{Changing to Hamiltonian function}
An equivalent formalism to the Lagrangian is the Hamiltonian which is in most cases easier to understand. The Legendre transformation can be used to change from Lagrangian to Hamiltonian formalism which is of the following form:

\begin{align}
\mathcal{H}(\mathbf{q}_j,\mathbf{p}_j,t) &= \sum_{i} \dot{\mathbf{q}}_i \frac{\partial \mathcal{L}}{\partial \dot{\mathbf{q}}_i} - \mathcal{L}(\mathbf{q}_j,\dot{\mathbf{q}}_j,t)
\intertext{where}
\frac{\partial \mathcal{L}}{\partial \dot{\mathbf{q}}_i} &= \mathbf{p}_i(\mathbf{q}_i,\dot{\mathbf{q}}_i,t)
\end{align}
is the momenta expressed with generalized coordinates $\mathbf{q}_i$ and velocities $\dot{\mathbf{q}}_i$. Therefore with the definition of the Born-Oppenheimer Lagrangian one can derive the Hamiltonian as:
\begin{align*}
\frac{\partial \mathcal{L}^{BO}}{\partial \dot{\mathbf{R}}_I} &= M_I \dot{\mathbf{R}}_I\\
\implies \dot{\mathbf{q}}_i \frac{\partial \mathcal{L}}{\partial \dot{\mathbf{q}}_i} &= \dot{\mathbf{R}}_I \cdot M_I \dot{\mathbf{R}}_I \\
\implies \mathcal{H}^{BO}(\mathbf{q}_j,\mathbf{p}_j,t)&=\sum_{I} M_I \dot{\mathbf{R}}_I^2 - \mathcal{L}^{BO}\\
\implies \mathcal{H}^{BO}(\mathbf{q}_j,\mathbf{p}_j,t)&=\frac{1}{2} \sum_{I} M_I \dot{\mathbf{R}}_I^2+ \mathcal{V}(\{\mathbf{R}_I\},D)\\
\iff \mathcal{H} &= \mathcal{T} + \mathcal{V}
\end{align*}
One look at the total differential of the Lagrangian and Hamiltonian lead to the coefficient comparison and consequently to the Hamiltonian equation of motion in absolute coordinates.

\begin{align*}
d\mathcal{L} &= \sum_{i} \left(  \frac{\partial \mathcal{L}}{\partial \mathbf{q}_i}d\mathbf{q}_i + \frac{\partial \mathcal{L}}{\partial \dot{\mathbf{q}}_i}d\dot{\mathbf{q}}_i  \right) + \frac{\partial \mathcal{L}}{\partial t} dt\\
d\mathcal{L} &= \sum_{i} \left(  \frac{\partial \mathcal{L}}{\partial \mathbf{q}_i}d\mathbf{q}_i + \mathbf{p}_id\dot{\mathbf{q}}_i  \right) + \frac{\partial \mathcal{L}}{\partial t} dt\\
d(\mathbf{p}_i\dot{\mathbf{q}}_i) &= d\mathbf{p}_i\dot{\mathbf{q}}_i+ \mathbf{p}_id\dot{\mathbf{q}}_i\\
d\mathcal{L} &= \sum_{i} \left(  \frac{\partial \mathcal{L}}{\partial \mathbf{q}_i}d\mathbf{q}_i +d(\mathbf{p}_i\dot{\mathbf{q}}_i) -  d\mathbf{p}_i\dot{\mathbf{q}}_i \right) + \frac{\partial \mathcal{L}}{\partial t} dt\\
d(\sum_{i} \mathbf{p}_i\dot{\mathbf{q}}_i - \mathcal{L})&=\sum_{i}\left(-\frac{\partial \mathcal{L}}{\partial \mathbf{q}_i}d\mathbf{q}_i +d\mathbf{p}_i\dot{\mathbf{q}}_i  \right)-\frac{\partial \mathcal{L}}{\partial t} dt \\
d\mathcal{H}&=\sum_{i}\left(-\frac{\partial \mathcal{L}}{\partial \mathbf{q}_i}d\mathbf{q}_i +d\mathbf{p}_i\dot{\mathbf{q}}_i  \right)-\frac{\partial \mathcal{L}}{\partial t} dt \\
d\mathcal{H}&=\sum_{i} \left(  \frac{\partial \mathcal{H}}{\partial \mathbf{q}_i}d\mathbf{q}_i + \frac{\partial \mathcal{H}}{\partial \mathbf{p}_i}d\mathbf{p}_i  \right) + \frac{\partial \mathcal{H}}{\partial t} dt\\
\implies \frac{\partial \mathcal{H}}{\partial \mathbf{q}_i}&=-\frac{\partial \mathcal{L}}{\partial \mathbf{q}_i},\;
\frac{\partial \mathcal{H}}{\partial \mathbf{p}_i}=\dot{\mathbf{q}}_i,\;
\frac{\partial \mathcal{H}}{\partial t}=-\frac{\partial \mathcal{L}}{\partial t}
\end{align*}
In case when the Euler-Lagrange equation \ref{eq:euler-lagrange} holds, it can be rewritten as:
\begin{equation}
\frac{\partial \mathcal{L}}{\partial \mathbf{q}_i} = \frac{d}{dt}\mathbf{p}_i=\dot{\mathbf{p}}_i
\end{equation}
and therefore also:
\begin{equation}
\frac{\partial \mathcal{H}}{\partial \mathbf{q}_j}=-\dot{\mathbf{p}}_j,\;\frac{\partial \mathcal{H}}{\partial \mathbf{p}_j}=\dot{\mathbf{q}}_j,\;\frac{\partial \mathcal{H}}{\partial t}=-\frac{\partial \mathcal{L}}{\partial t}
\end{equation}
Thus if one has the Hamiltonian of the system the derivation for the equations of motions is straightforward. A possible and well-known framework to accomplish this in molecular dynamics is to use Schr\"odinger's equation with using the correspondence principle, explained in the next section.

\subsection{Derivation of Classical Molecular Dynamics}
\label{sec:cmd}
To derive classical molecular dynamics a good choice is to start with non-relativistic quantum mechanics formalized via the time-dependent Schr\"odinger equation:
\begin{equation}
\mathrm{i} \hbar \frac{\partial }{\partial t} \Psi = \hat{\mathcal{H}} \Psi
\label{eq:tdse}
\end{equation}
, where the correspondence-principle was used to rewrite the energy equation
\begin{equation}
E=\frac{\mathbf{p}^2}{2m}+V(\mathbf{r},t)=\mathcal{T}(\mathbf{p})+\mathcal{V}(\mathbf{r},t)=\mathcal{H}
\end{equation} 
by replacing the non-relativistic quantities $E$, $\mathbf{p}$ and $\mathbf{r}$ with their corresponding operators
\begin{align*}
E \rightarrow \hat{E} &=\mathrm{i}\hbar \frac{\partial }{\partial t}\\
\mathbf{p} \rightarrow \hat{\mathbf{p}} &=-\mathrm{i}\hbar \nabla\\
\mathbf{r} \rightarrow \hat{\mathbf{r}}  &= \mathbf{r}\\
\mathcal{H} \rightarrow \hat{H} &=-\mathrm{i}\hbar \nabla^2 + \hat{V}(\mathbf{r},t))
\end{align*}
For this discussion $\Psi=\Psi(\{\mathbf{r}_i\},\{\mathbf{R}_I \};t)$ is a function depending on $N$ electrons with coordinates $\{\mathbf{r}_i\}_{i=1}^{N}$ and $M$ nuclei with coordinates $\{\mathbf{R}_I\}_{I=1}^{M}$ with a standard Hamiltonian constructed with the Coulomb potential:
\begin{align}
\hat{H} &=\hat{T}_n + \hat{T}_e + \hat{V}_{n-e}\label{def:hamiltonian}\\
\hat{T}_n &=-\sum_{I}\frac{\hbar^2}{2M_I} \nabla^2_I\label{def:nuclearkinetic}\\
\hat{T}_e &=-\sum_{i}\frac{\hbar^2}{2m_e} \nabla^2_i\label{def:electronickinetic}\\
\hat{V}_{n-e}&=\sum_{i<j}\frac{e^2}{|\mathbf{r}_i-\mathbf{r}_j|} - \sum_{I,i}\frac{e^2Z_I}{|\mathbf{R}_I-\mathbf{r}_i|} + \sum_{I<J}\frac{e^2Z_IZ_J}{|\mathbf{R}_I-\mathbf{R}_J|}\label{def:coulomboperator}\\
\hat{H}_{el}&=\hat{H}-\hat{T}_n=\hat{T}_e + \hat{V}_{n-e}\label{def:electronichamilton}
\end{align}

In case that one assumes that the time coordinate can be separated from the spatial coordinates one can use Louis de Broglies ansatz for standing waves
\begin{equation}
\Psi(\mathbf{r},t)=A\cdot \exp(-\frac{\mathrm{i}}{\hbar}(Et-\mathbf{r}\cdot\mathbf{p}))
\label{ansatz:louisdebroglieswave}
\end{equation}
to transform
\begin{align*}
\mathrm{i} \hbar \frac{\partial }{\partial t} (A\cdot \exp(-\frac{\mathrm{i}}{\hbar}(Et-\mathbf{r}\cdot\mathbf{p})) )&=\hat{H}\Psi(\mathbf{r},t)\\
\mathrm{i} \hbar  A\cdot \exp(-\frac{\mathrm{i}}{\hbar}(Et-\mathbf{r}\cdot\mathbf{p})) \frac{\partial }{\partial t}(-\frac{\mathrm{i}}{\hbar}(Et-\mathbf{r}\cdot\mathbf{p})) &=\hat{H}\Psi(\mathbf{r},t)\\
\mathrm{i} \hbar\cdot -\frac{\mathrm{i}}{\hbar} \cdot E \cdot A\cdot \exp(-\frac{\mathrm{i}}{\hbar}(Et-\mathbf{r}\cdot\mathbf{p}))  &=\hat{H}\Psi(\mathbf{r},t)\\
\mathrm{i} \hbar\cdot -\frac{\mathrm{i}}{\hbar} \cdot E \cdot \Psi(\mathbf{r},t)&=\hat{H}\Psi(\mathbf{r},t)\\
 E \Psi(\mathbf{r},t)&=\hat{H}\Psi(\mathbf{r},t)\\
\end{align*}
into the time independent Schr\"odinger equation
\begin{equation}
\hat{H}\Psi(\mathbf{r},t)=E \Psi(\mathbf{r},t)
\label{eq:tiseclassic}
\end{equation}
where this is equivalent to an eigenvalue problem
\begin{equation}
\mathcal{M} \mathbf{v} = \lambda \mathbf{v}
\label{eigenvalueproblem}
\end{equation}
with matrix $\mathcal{M}$, eigenvector $\mathbf{v}$ and eigenvalue $\lambda$. Hence it is of importance to choose the right basis such that the Hamiltonian can expressed as a matrix.

\section{Solving Schr\"odinger equation with two different Ansatz}
\subsection{Ansatz for TDSCF}
For solving the time-dependent Schr\"odinger equation \ref{eq:tdse} one has to use an ansatz. The simplest case is to assume that the total wavefunction is separable in an electronic and nuclear part in the following way:
\begin{equation}
\Psi( \{ \mathbf{r}_i \}, \{ \mathbf{R}_I \};t) \approx \chi( \{ \mathbf{R}_I \};t) \prod_{k} \Phi_k( \{ \mathbf{r}_i \} ;t)
\label{ansatz:tdscf}
\end{equation}
Worth noting is that this ansatz yields the time-dependent self-consistent field method derived as early as 1930 by Dirac \cite{dirac1930note}. This derivation will be shown for the purpose of illustrating where the interdependence of the final equations are coming from. For further reference on this derivation one can look in \cite{makri1987time} for a more complex Hamiltonian function. First step is to insert the ansatz \ref{ansatz:tdscf} into the time-dependent Schr\"odinger equation \ref{eq:tdse}.
\begin{equation}
\mathrm{i}\hbar \frac{\partial}{\partial t} \left(\chi( \{ \mathbf{R}_I \};t) \prod_{k} \Phi_k( \{ \mathbf{r}_i \} ;t)\right) = \left( \hat{T}_n + \hat{T}_e + \hat{V}_{n-e} \right)\chi( \{ \mathbf{R}_I \};t) \prod_{k} \Phi_k( \{ \mathbf{r}_i \} ;t)
\label{eq:tdsewithansatz}
\end{equation}
This equation can be separated into two parts. One is for describing the nuclear part using a projection on to electronic coordinates and vice versa. Derivation for the nuclear part involve multiplying $\prod_{k} \Bra{\Phi_k}$ from the left which is equivalent to the projection. Hence the equation \ref{eq:tdsewithansatz} can be expanded and reformulated as:
\begin{align*}
&\prod_{k} \Bra{\Phi_k} \mathrm{i}\hbar \frac{\partial \chi}{\partial t} \prod_{k} \Phi_k + \prod_{k} \Bra{\Phi_k} \mathrm{i}\hbar \chi \sum_{j}\prod_{k,k \neq j} \frac{\partial\Phi_j}{\partial t}\Phi_k \\&= \prod_{k} \Bra{\Phi_k} \hat{T}_n \chi \prod_{k} \Phi_k + \prod_{k} \Bra{\Phi_k} \hat{T}_e \chi \prod_{k} \Phi_k + \prod_{k} \Bra{\Phi_k} \hat{V}_{n-e} \chi \prod_{k} \Phi_k
\end{align*}
The individual terms can be all simplified because of the property of the orbital functions. First of all,
\begin{align*}
\prod_{k} \Bra{\Phi_k} \prod_{j}\Phi_j = \prod_{k,j}\Braket{\Phi_k | \Phi_j}=\delta_{kj}
\intertext{, can be used since orbitals have to be orthogonal to each other, hence the only interesting case is $k=j$. Note that we used the Kronecker delta on the right side. Therefore also the following holds:}
\prod_{k} \Bra{\Phi_k} \sum_{j}\prod_{k,k \neq j} \frac{\partial\Phi_j}{\partial t}\Phi_k = \sum_{j} \Braket{\Phi_j|\frac{\partial\Phi_j}{\partial t}}
\end{align*}
One can easily convince oneself that the all terms cancel each other except the $j$ term because of the time derivative. Now since this projection is independent of the $\chi$ functions they can be extracted to the right which is shown next:
\begin{align*}
\mathrm{i}\hbar \frac{\partial \chi}{\partial t} +\mathrm{i}\hbar \sum_{j} \Braket{\Phi_j|\frac{\partial\Phi_j}{\partial t}}\chi &= \hat{T}_n\chi+ \sum_{i} \Bra{\Phi_i} \hat{T}_e(i)\Ket{\Phi_i} \chi + \sum_{i} \Bra{\Phi_i} \hat{V}_{n-e}(i)\Ket{\Phi_i} \chi \\
\intertext{This is valid because kinetic operator of electrons and the Coulomb term is a summation over all coordinates $\{\mathbf{r}_i \}$}
\mathrm{i}\hbar \frac{\partial \chi}{\partial t} + \mathrm{i}\hbar\sum_{j} \Braket{\Phi_j|\frac{\partial\Phi_j}{\partial t}}\chi &= \hat{T}_n\chi+ \sum_{i} \Bra{\Phi_i} \hat{T}_e(i)+\hat{V}_{n-e}(i)\Ket{\Phi_i} \chi\\
\intertext{These two operators can be combined to the $\hat{H}_{el}$ where in Bra and Ket are all electronical coordinates. Also the summation and integral can freely be exchanged.}
\mathrm{i}\hbar \frac{\partial \chi}{\partial t} + \mathrm{i}\hbar\sum_{j} \Braket{\Phi_j|\frac{\partial\Phi_j}{\partial t}}\chi &= \hat{T}_n\chi+  \Bra{\Phi_i} \hat{H}_{el}\Ket{\Phi_i} \chi\\
\end{align*}
This equation can be further simplified with the introduction of a phase factor into the $\chi$ function. The role of this factor is to cancel the term including the time derivative of the electronic orbital. This can be achieved with the following substitution:
\begin{equation}
\chi \rightarrow \chi \cdot \exp\left( \frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt'\sum_{i}\mathrm{i}\hbar\Braket{\Phi_i|\dot{\Phi}_i} \right)
\label{phasefactorsinglechi}
\end{equation}
This can be done since the term in the exponential function is only dependent on the electronic configuration and not on the nuclear part. Therefore only the $\chi$ time derivative with the product rule will yield a new term, namely
\begin{align*}
\frac{\partial \chi \exp\left( \frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt'\sum_{i}\mathrm{i}\hbar\Braket{\Phi_i|\dot{\Phi}_i} \right)}{\partial t} = \frac{\partial \chi}{\partial t}\exp\left(...\right) + \chi\exp\left(...\right) \cdot \frac{\mathrm{i}}{\hbar} \cdot \sum_{i}\mathrm{i}\hbar\Braket{\Phi_i|\dot{\Phi}_i}\\
=\frac{\partial \chi}{\partial t}\exp\left(...\right) - \chi\exp\left(...\right) \sum_{i}\Braket{\Phi_i|\dot{\Phi}_i}
\end{align*}
Which will be inserted into the last equation and the exponential can be canceled on each side yielding:
\begin{equation}
\mathrm{i}\hbar \frac{\partial \chi}{\partial t} = \hat{T}_n\chi+  \Bra{\Phi_i} \hat{H}_{el}\Ket{\Phi_i} \chi
\label{eqfornuclearpart}
\end{equation}
Now one can look at the projection on to the $\chi$ function which is equivalent to multiply equation \ref{eq:tdsewithansatz} from the left with $\Bra{\chi}$ expanding and reformulating result to:
\begin{align*}
&\Bra{\chi}\mathrm{i}\hbar \frac{\partial \chi}{\partial t} \prod_{k} \Phi_k + \Bra{\chi} \mathrm{i}\hbar \chi \sum_{j}\prod_{k,k \neq j} \frac{\partial\Phi_j}{\partial t}\Phi_k \\ &= \Bra{\chi} \hat{T}_n \chi \prod_{k} \Phi_k + \Bra{\chi} \hat{T}_e \chi \prod_{k} \Phi_k + \Bra{\chi} \hat{V}_{n-e} \chi \prod_{k} \Phi_k\\
\intertext{Also the nuclear functions are orthogonal hence $\Braket{\chi | \chi}=1$. Furthermore the electronic part is independent from the nuclear part which can be separated into:}
&\mathrm{i}\hbar \Braket{\chi|\frac{\partial \chi}{\partial t}} \prod_{k} \Phi_k + \mathrm{i}\hbar \sum_{j}\prod_{k,k \neq j} \frac{\partial\Phi_j}{\partial t}\Phi_k \\&= \Bra{\chi}\hat{T}_n\Ket{\chi} \prod_{k} \Phi_k + \hat{T}_e \prod_{k} \Phi_k + \Bra{\chi} \hat{V}_{n-e} \Ket{\chi} \prod_{k} \Phi_k
\end{align*}
To not lose the total overview let us first look at a single $\phi$ function before generalizing to the whole product. With a single function the equation reduces to:
\begin{align*}
\mathrm{i}\hbar \Braket{\chi|\frac{\partial \chi}{\partial t}} \Phi + \mathrm{i}\hbar \frac{\partial\Phi}{\partial t} = \Bra{\chi}\hat{T}_n\Ket{\chi} \Phi + \hat{T}_e \Phi + \Bra{\chi} \hat{V}_{n-e} \Ket{\chi} \Phi
\end{align*}
Here one can also introduce a phase factor for the $\Phi$ function to further reduce the equation. Note however that the phase factor only include terms depending on the nuclear function. With $\Phi$ becoming,
\begin{equation}
\Phi \rightarrow \Phi \cdot \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \mathrm{i}\hbar \Braket{\chi|\frac{\partial \chi}{\partial t}} - \Bra{\chi}\hat{T}_n\Ket{\chi}   \right)
\label{phasefactorsinglephi}
\end{equation}
, the partial time derivative therefore is:
\begin{align*}
\frac{\partial \Phi\exp(...)}{\partial t} = \frac{\partial \Phi}{\partial t}+\Phi\exp(...)\cdot \frac{\mathrm{i}}{\hbar} \cdot (\mathrm{i}\hbar \Braket{\chi|\frac{\partial \chi}{\partial t}} - \Bra{\chi}\hat{T}_n\Ket{\chi})
\intertext{and hence with a prefactor:}
\mathrm{i}\hbar \Braket{\chi|\frac{\partial \chi}{\partial t}} \Phi\exp(...) + \mathrm{i}\hbar \frac{\partial \Phi}{\partial t}+\Phi\exp(...)\cdot (-\mathrm{i}\hbar\Braket{\chi|\frac{\partial \chi}{\partial t}} +\Bra{\chi}\hat{T}_n\Ket{\chi}) = \\ \Bra{\chi}\hat{T}_n\Ket{\chi} \Phi\exp(...) + \hat{T}_e \Phi\exp(...) + \Bra{\chi} \hat{V}_{n-e} \Ket{\chi} \Phi\exp(...)
\end{align*}
And thus the exponential function cancels on each side and two terms were reduced to the final form of:
\begin{equation}
\mathrm{i}\hbar \frac{\partial \Phi}{\partial t} =\hat{T}_e \Phi + \Bra{\chi} \hat{V}_{n-e} \Ket{\chi} \Phi
\label{eqforelectricpart}
\end{equation}
The phase factors of equation \ref{eqfornuclearpart} and \ref{eqforelectricpart} can be combined as follows:
\begin{align*}
&\chi\Phi \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \mathrm{i}\hbar \Braket{\chi|\dot{\chi}} - \Bra{\chi}\hat{T}_n\Ket{\chi}   \right) \exp\left( \frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt'\mathrm{i}\hbar\Braket{\Phi|\dot{\Phi}} \right)\\ 
&=\chi \Phi \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \mathrm{i}\hbar\Braket{\chi|\dot{\chi}} - \Bra{\chi}\hat{T}_n\Ket{\chi}+\mathrm{i}\hbar\Braket{\Phi|\dot{\Phi}}\right)
\intertext{were we can expand terms with $\Braket{\chi|\chi}$ and $\Braket{\Phi|\Phi}$:}
&=\chi \Phi \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \mathrm{i}\hbar\Braket{\chi|\dot{\chi}}\Braket{\Phi|\Phi} - \Braket{\Phi|\Phi}\Bra{\chi}\hat{T}_n\Ket{\chi}+\mathrm{i}\hbar\Braket{\chi|\chi}\Braket{\Phi|\dot{\Phi}}\right)
\intertext{which can be further collapsed into:}
&=\chi \Phi \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \Bra{\Phi\chi} \mathrm{i}\hbar (\phi\frac{\partial \chi}{\partial t}+\chi\frac{\partial \Phi}{\partial t})\Ket{} - \Bra{\Phi\chi}\hat{T}_n\Ket{\Phi\chi} \right)\\
&=\chi \Phi \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \Bra{\Phi\chi} \mathrm{i}\hbar \frac{\partial}{\partial t}(\Phi\chi) - \Bra{\Phi\chi}\hat{T}_n\Ket{\Phi\chi} \right)
\intertext{Insert again time dependent Schr\"odinger eq.}
&=\chi \Phi \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \Bra{\Phi\chi} \hat{H}\Ket{\Phi\chi} - \Bra{\Phi\chi}\hat{T}_n\Ket{\Phi\chi} \right)\\
&=\chi \Phi \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \Bra{\Phi\chi} \hat{H}_{el}\Ket{\Phi\chi} \right)\\
\end{align*}
This means the most compact form for an ansatz with only one electronic function and phasefactor is:
\begin{equation}
\Psi( \{ \mathbf{r}_i \}, \{ \mathbf{R}_I \};t) \approx \chi( \{ \mathbf{R}_I \};t) \Phi( \{ \mathbf{r}_i \} ;t)\cdot \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \Bra{\Phi\chi} \hat{H}_{el}\Ket{\Phi\chi} \right)
\label{eq:tdsewithansatz2}
\end{equation}
Now lets return to a case with more than one electronic function. The equation takes the following form:
\begin{align*}
&\mathrm{i}\hbar \Braket{\chi|\frac{\partial \chi}{\partial t}} \Phi_1\Phi_2 + \mathrm{i}\hbar \frac{\partial\Phi_1}{\partial t}\Phi_2+\mathrm{i}\hbar\frac{\partial\Phi_2}{\partial t}\Phi_1\\
&= \Bra{\chi}\hat{T}_n\Ket{\chi} \Phi_1\Phi_2 + \hat{T}_e \Phi_1\Phi_2 + \Bra{\chi} \hat{V}_{n-e} \Ket{\chi} \Phi_1\Phi_2
\intertext{Now consider a projection on $\Phi_2$.}
&\Bra{\Phi_2}\mathrm{i}\hbar \Braket{\chi|\frac{\partial \chi}{\partial t}} \Phi_1\Phi_2 + \Bra{\Phi_2}\mathrm{i}\hbar \frac{\partial\Phi_1}{\partial t}\Phi_2+\Bra{\Phi_2}\mathrm{i}\hbar\frac{\partial\Phi_2}{\partial t}\Phi_1\\
&= \Bra{\Phi_2} \Bra{\chi}\hat{T}_n\Ket{\chi} \Phi_1\Phi_2 + \Bra{\Phi_2} \hat{T}_e \Phi_1\Phi_2 + \Bra{\Phi_2} \Bra{\chi} \hat{V}_{n-e} \Ket{\chi} \Phi_1\Phi_2
\intertext{With $\Braket{\Phi_2|\Phi_2}=1$ this gives us:}
&\mathrm{i}\hbar \Braket{\chi|\frac{\partial \chi}{\partial t}} \Phi_1 + \mathrm{i}\hbar \frac{\partial\Phi_1}{\partial t}+\mathrm{i}\hbar\Braket{\Phi_2|\frac{\partial\Phi_2}{\partial t}}\Phi_1\\
&= \Bra{\chi}\hat{T}_n\Ket{\chi} \Phi_1 + \Bra{\Phi_2} \hat{T}_e\Ket{\Phi_2} \Phi_1 + \Bra{\chi\Phi_2} \hat{V}_{n-e} \Ket{\chi\Phi_2} \Phi_1
\intertext{Introducting again a phasefactor to $\Phi_1$ function:}
&\Phi_1 \rightarrow \Phi_1 \cdot \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \mathrm{i}\hbar \Braket{\chi|\dot{\chi}} +\mathrm{i}\hbar\Braket{\Phi_2|\dot{\Phi_2}}  - \Bra{\chi}\hat{T}_n\Ket{\chi}   \right)\\
&\mathrm{i}\hbar \frac{\partial\Phi_1}{\partial t}= \Bra{\Phi_2} \hat{T}_e\Ket{\Phi_2} \Phi_1 + \Bra{\chi\Phi_2} \hat{V}_{n-e} \Ket{\chi\Phi_2} \Phi_1
\intertext{And vice versa:}
&\Phi_2 \rightarrow \Phi_2 \cdot \exp\left(\frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt' \mathrm{i}\hbar \Braket{\chi|\dot{\chi}} +\mathrm{i}\hbar\Braket{\Phi_1|\dot{\Phi_1}}  - \Bra{\chi}\hat{T}_n\Ket{\chi}   \right)\\
&\mathrm{i}\hbar \frac{\partial\Phi_2}{\partial t}= \Bra{\Phi_1} \hat{T}_e\Ket{\Phi_1} \Phi_2 + \Bra{\chi\Phi_1} \hat{V}_{n-e} \Ket{\chi\Phi_1} \Phi_2
\intertext{Recombining all phasefactors:}
&\chi \Phi_1 \Phi_2 \exp( \frac{\mathrm{i}}{\hbar} \int_{t0}^{t}dt'\sum_{i}^{2}\mathrm{i}\hbar\Braket{\Phi_i|\dot{\Phi}_i} \\
&+\mathrm{i}\hbar\Braket{\chi|\dot{\chi}} +\mathrm{i}\hbar\Braket{\Phi_1|\dot{\Phi_1}}  - \Bra{\chi}\hat{T}_n\Ket{\chi}\\
&+\mathrm{i}\hbar \Braket{\chi|\dot{\chi}} +\mathrm{i}\hbar\Braket{\Phi_2|\dot{\Phi_2}}  - \Bra{\chi}\hat{T}_n\Ket{\chi} )
\intertext{With analogous reformulation one can derive:}
&\chi \Phi_1 \Phi_2 \exp\left( \frac{\mathrm{i}}{\hbar} 2 \cdot \int_{t0}^{t}dt' \Bra{\chi\Phi_1\Phi_2}\hat{H}_{el}\Ket{\chi\Phi_1\Phi_2} \right)
\end{align*}
Now one can write easily generalized formulas for the whole product:
\begin{align}
&\mathrm{i}\hbar \frac{\partial \chi}{\partial t} = \hat{T}_n\chi+  \Bra{\Phi_i} \hat{H}_{el}\Ket{\Phi_i} \chi, \quad  i=1...N \label{eq:tdscfnuclear}\\
&\mathrm{i}\hbar \frac{\partial\Phi_k}{\partial t}= \Bra{\Phi_{k'}} \hat{T}_e\Ket{\Phi_{k'}} \Phi_k + \Bra{\chi\Phi_{k'}} \hat{V}_{n-e} \Ket{\chi\Phi_{k'}} \Phi_k, \quad k,k'=1...N \wedge k'\neq k\label{eq:tdscfelectronic}\\
&\Psi \approx \chi \prod_{k}\Phi_k \cdot \exp\left( \frac{\mathrm{i}}{\hbar} N \cdot \int_{t0}^{t}dt' \Bra{\chi\Phi_i}\hat{H}_{el}\Ket{\chi\Phi_i} \right),\quad  i=1...N \label{ansatz:tdscfwithphase}
\end{align}
Notable is the interdependence of electronic and nuclear coordinates for the self-consistent field method. The equation of the nuclear part is depending on an average over the electronic Hamiltonian and the electronic part also takes an average over the nuclear part. Here iterative methods have to be used to get a solution for both equations. As an alternative to a complete iterative scheme Born-Oppenheimer provides a different approach.

\subsection{Ansatz for BOMD}
In the Born-Oppenheimer framework first one does only look at the time independent Schr\"odinger equation since the mass of the nuclei is massive larger than the mass of electrons and therefore the motion of the electron can be viewed as instantaneous in comparison to the nuclei. Here one assumes that the total wavefunction can be expanded into its eigenstates since the time independent Schr\"odinger equation is similar to an eigenvalue problem \ref{eigenvalueproblem} where for each state $k$ has to fulfill it.
\begin{equation}
\hat{H}(\{\mathbf{r}_i\},\{\mathbf{R}_I\}) \Psi_k(\{\mathbf{r}_i\},\{\mathbf{R}_I\}) = E_k\Psi_k(\{\mathbf{r}_i\},\{\mathbf{R}_I\})\label{eq:tise}
\end{equation}
In Born-Oppenheimer framework one assumes that each eigenstate $\Psi_k$ can be completely represented with electronic wavefunctions $\Psi_{el,m}$ as a basis.
\begin{equation}
\Psi_k( \{ \mathbf{r}_i \}, \{ \mathbf{R}_I \};t) = \sum_{m=0}^{\infty} \chi_{k,m}( \{ \mathbf{R}_I \};t)\Psi_{el,m}( \{ \mathbf{r}_i \},\{ \mathbf{R}_I \})\label{basis:exact}
\end{equation}
To represent exactly the whole wavefunction for the $k$th state all electronical states $\{\Psi_{el,m}\}$ are needed. 
The Born-Oppenheimer approximation in essence simplifies $\Psi_k$ as a single product of a nuclear and electronic wave function
\begin{equation}
\Psi_k( \{ \mathbf{r}_i \}, \{ \mathbf{R}_I \}) \to \Psi_{k,m}( \{ \mathbf{r}_i \}, \{ \mathbf{R}_I \})\approx \chi_{k,m}(\{ \mathbf{R}_I \})\cdot\Psi_{el,m}^{\mathbf{R}_I}(\{ \mathbf{r}_i \})\label{ansatz:bo}
\end{equation}
where the electronic wavefunctions solves the time independent electronic Schr\"odinger equation:
\begin{equation}
\hat{H}_{el}\Psi_{el,m}^{\{\mathbf{R}_I\}}(\{\mathbf{r}_i\}) = E_{el,m} \Psi_{el,m}^{\{\mathbf{R}_I\}}(\{\mathbf{r}_i\})\label{eq:tiese}
\end{equation}

Inserting ansatz \ref{ansatz:bo} into time independent Schr\"odinger equation \ref{eq:tise} gives:
\begin{align*}
\hat{H}(\chi_{k,m}\cdot \Psi_{el,m}) &= E_k\chi_{k,m}\Psi_{el,m}\\
\intertext{using the definition \ref{def:electronichamilton}}
\hat{T}_n\chi_{k,m}\Psi_{el,m}+\hat{H}_{el}\chi_{k,m}\Psi_{el,m} &= E_k\chi_{k,m}\Psi_{el,m}
\intertext{$\hat{H}_{el}$ has no influence on $\chi_{k,m}$ and vice versa $\hat{T}_n$ has no influence on $\Psi_{el,m}$. Therefore a projection on to $\Psi_{el,m}$ yields:}
\Bra{\Psi_{el,m}} \hat{T}_n\chi_{k,m}\Psi_{el,m}+\Bra{\Psi_{el,m}}\hat{H}_{el}\chi_{k,m}\Psi_{el,m} &= \Bra{\Psi_{el,m}}E_k\chi_{k,m}\Psi_{el,m}\\
\hat{T}_n\chi_{k,m}\Braket{\Psi_{el,m}|\Psi_{el,m}}+\Bra{\Psi_{el,m}}\hat{H}_{el}(\{ \mathbf{r}_i\},\{ \mathbf{R}_I\})\Ket{\Psi_{el,m}}\chi_{k,m} &= E_k\chi_{k,m}\Braket{\Psi_{el,m}|\Psi_{el,m}}
\end{align*}
Where $\Braket{\Psi_{el,m}|\Psi_{el,m}}=\delta_{mm}=1$ and $\Bra{\Psi_{el,m}}\hat{H}_{el}(\{ \mathbf{r}_i\},\{ \mathbf{R}_I\})\Ket{\Psi_{el,m}}=E_{el,m}$ hence the final nuclear Schr\"odinger equation in BO-approximation is:
\begin{equation}
\left[ \hat{T}_n+E_{el,m}(\{\mathbf{R}_I\})\right]\chi_{k,m}=E_k\chi_{k,m}
\label{eq:nse}
\end{equation}
The structure of equation \ref{eq:nse} shows that this is again an eigenvalue problem but here for the nuclear orbital functions. Meaning that to solve this equation one has to first calculate the electronic energy for the given nuclear configuration $\{\mathbf{R}_I\}$ which is given by solving \ref{eq:tiese}. For completeness the general case where the exact representation \ref{basis:exact} is used will be shown next. Inserting \ref{basis:exact} into \ref{eq:tise} yields:
\begin{align*}
\hat{H} \sum_{m}\chi_{k,m}\Psi_{el,m}&=E_k\sum_{m}\chi_{k,m}\Psi_{el,m}
\intertext{Using again the definition \ref{def:electronichamilton}}
\hat{T}_n\sum_{m}\chi_{k,m}\Psi_{el,m} + \hat{H}_{el}\sum_{m}\chi_{k,m}\Psi_{el,m}&=E_k\sum_{m}\chi_{k,m}\Psi_{el,m}
\intertext{Project on to $\Bra{\Psi_{el,p}}$.}
\Bra{\Psi_{el,p}}\hat{T}_n\Ket{\sum_{m}\chi_{k,m}\Psi_{el,m}} + \Bra{\Psi_{el,p}}\hat{H}_{el}\Ket{\sum_{m}\chi_{k,m}\Psi_{el,m}}&=\Bra{\Psi_{el,p}}E_k\Ket{\sum_{m}\chi_{k,m}\Psi_{el,m}}
\intertext{Integral and sum can be exchanged.}
\sum_{m}\Bra{\Psi_{el,p}}\hat{T}_n\Ket{\chi_{k,m}\Psi_{el,m}} + \sum_{m}\Bra{\Psi_{el,p}}\hat{H}_{el}\Ket{\chi_{k,m}\Psi_{el,m}}&=\sum_{m}\Bra{\Psi_{el,p}}E_k\Ket{\chi_{k,m}\Psi_{el,m}}
\intertext{The electronic Hamiltonian and $E_k$ have no influence on $\chi$ functions.}
\sum_{m}\Bra{\Psi_{el,p}}\hat{T}_n\Ket{\chi_{k,m}\Psi_{el,m}} + \sum_{m}\Bra{\Psi_{el,p}}\hat{H}_{el}\Ket{\Psi_{el,m}}\chi_{k,m}&=\sum_{m}\Bra{\Psi_{el,p}}E_k\Ket{\Psi_{el,m}}\chi_{k,m}
\intertext{$E_k$ is a scalar.}
\sum_{m}\Bra{\Psi_{el,p}}\hat{T}_n\Ket{\chi_{k,m}\Psi_{el,m}} + \sum_{m}\Bra{\Psi_{el,p}}\hat{H}_{el}\Ket{\Psi_{el,m}}\chi_{k,m}&=E_k\sum_{m}\Braket{\Psi_{el,p}|\Psi_{el,m}}\chi_{k,m}
\intertext{Using Kronecker delta.}
\sum_{m}\Bra{\Psi_{el,p}}\hat{T}_n\Ket{\chi_{k,m}\Psi_{el,m}} + \sum_{m}\Bra{\Psi_{el,p}}\hat{H}_{el}\Ket{\Psi_{el,m}}\chi_{k,m}&=E_k\sum_{m}\delta_{pm}\chi_{k,m}
\intertext{The sum collapses on the right hand side except $p=m$.}
\sum_{m}\Bra{\Psi_{el,p}}\hat{T}_n\Ket{\chi_{k,m}\Psi_{el,m}} + \sum_{m}\Bra{\Psi_{el,p}}\hat{H}_{el}\Ket{\Psi_{el,m}}\chi_{k,m}&=E_k\chi_{k,m}
\intertext{Using electronic Schr\"odinger equation \ref{eq:tiese}.}
\sum_{m}\Bra{\Psi_{el,p}}\hat{T}_n\Ket{\chi_{k,m}\Psi_{el,m}} + \sum_{m}\Bra{\Psi_{el,p}}E_{el,m}\Ket{\Psi_{el,m}}\chi_{k,m}&=E_k\chi_{k,m}
\intertext{$E_{el,m}$ is again a scalar. With Kronecker delta the second sum collapses.}
\sum_{m}\Bra{\Psi_{el,p}}\hat{T}_n\Ket{\chi_{k,m}\Psi_{el,m}} + E_{el,m}\chi_{k,m}&=E_k\chi_{k,m}
\end{align*}
Looking at the definition \ref{def:nuclearkinetic} for $\hat{T}_n=-\sum_{I}\frac{1}{2M_I}\Delta_I$, the Laplace operator has to be evaluated.
\begin{align*}
\nabla_I^2(\chi_{k,m}\Psi_{el,m})=\nabla_I \cdot (\Psi_{el,m}\nabla_I\chi_{k,m}+\chi_{k,m}\nabla_I\Psi_{el,m}) \\
=\Psi_{el,m}\Delta_I\chi_{k,m}+2(\nabla_I\chi_{k,m})\cdot(\nabla_I\Psi_{el,m})+\chi_{k,m}\Delta_I\Psi_{el,m}
\end{align*}
Hence:
\begin{align*}
\Psi_{el,m}\Delta_I\chi_{k,m} &\rightarrow \sum_{m}\sum_{I}\Braket{\Psi_{el,p}|\Psi_{el,m}}\left(-\frac{1}{2M_I}\Delta_I \right)\chi_{k,m}\\
2(\nabla_I\chi_{k,m})\cdot(\nabla_I\Psi_{el,m})&\rightarrow \sum_{m}\sum_{I}2\Bra{\Psi_{el,p}}\nabla_I\Ket{\Psi_{el,m}}\left(-\frac{1}{2M_I}\nabla_I \right)\chi_{k,m}\\
\chi_{k,m}\Delta_I\Psi_{el,m} &\rightarrow \sum_{m}\sum_{I}\Bra{\Psi_{el,p}}\left(-\frac{1}{2M_I}\Delta_I \right)\Ket{\Psi_{el,m}}\chi_{k,m}\\
\end{align*}
The first term is again equivalent to $\hat{T}_n\chi_{k,m}$. Summarized the final equation is of the following form:
\begin{align*}
\hat{T}_n\chi_{k,m} +\sum_{m}\sum_{I}2\Bra{\Psi_{el,p}}\nabla_I\Ket{\Psi_{el,m}}\left(-\frac{1}{2M_I}\nabla_I \right)\chi_{k,m} +\\ \sum_{m}\sum_{I}\Bra{\Psi_{el,p}}\left(-\frac{1}{2M_I}\Delta_I \right)\Ket{\Psi_{el,m}}\chi_{k,m}
+ E_{el,m}\chi_{k,m}=E_k\chi_{k,m}
\end{align*}
The double sum is also called the non-adiabatic coupling term $\hat{C}_{pm}$.
\begin{equation}
\hat{C}_{pm} = \sum_{I}2\Bra{\Psi_{el,p}}\nabla_I\Ket{\Psi_{el,m}}\left(-\frac{1}{2M_I}\nabla_I\right)+\sum_I\Bra{\Psi_{el,p}} \left(-\frac{1}{2M_I}\Delta_I\right)\Ket{\Psi_{el,m}}
\end{equation}
And therefore the exact nuclear Schr\"odinger equation ca be written as:
\begin{equation}
\hat{T}_n\chi_{k,m} + \sum_{m}\hat{C}_{pm}\chi_{k,m}+E_{el,m}\chi_{k,m}=E_k\chi_{k,m}
\label{eq:entise}
\end{equation}
The $\hat{C}_{pm} $ terms describe the resonance between oscillation levels of neighboring electronic states. Approximations therefore make only sense when the electronic states in a system are not coupled. There are two famous approximations. First the adiabatic approximation:
\begin{align}
\hat{C}_{pm}=0 \;  \forall m \neq n \; & \rightarrow \;\hat{T}_n\chi_{k,m}+\hat{C}_{mm}\chi_{k,m}+E_{el,m}\chi_{k,m}=E_k\chi_{k,m}
\intertext{And second the Born-Oppenheimer approximation:}
\hat{C}_{pm}=0 \; \forall m,p \; & \rightarrow \; \hat{T}_n\chi_{k,m} +E_{el,m}\chi_{k,m}=E_k\chi_{k,m}
\end{align}
Solution to the nuclear Schr\"odinger equation \ref{eq:entise} leads to the oscillation levels. Hence the nuclei are moving in a field of electrons. The next step to derive molecular dynamics is to approximate the nuclei as classical point particles which is done in the next section.

\subsection{Approximation of nuclei as classical point particles}
A well-known route to extract semiclassical mechanics from quantum mechanics in general starts with rewriting the corresponding wavefunction for nuclei
\begin{equation}
\chi_{k}(\{ \mathbf{R}_I\};t)=A_k(\{ \mathbf{R}_I\};t)\exp\left[ \frac{\mathrm{i}}{\hbar}S_k(\{ \mathbf{R}_I\};t) \right]
\label{ansatz:pointparticle}
\end{equation}
in terms of an amplitude factor $A_k$ and a phase $S_k$ which are both considered to be real and $A_k > 0$ in this polar representation. This ansatz inserted into \ref{eq:nse} choosing electronic state $k$ and remembering that in time dependent case we use $E_k=\mathrm{i}\hbar\frac{\partial}{\partial t}$, results in equations for $A_k$ and $S_k$ respectively. Starting with
\begin{align*}
&\left[ \hat{T}_n+E_{el}\right]A_k\exp(\frac{\mathrm{i}}{\hbar}S_k)=\mathrm{i}\hbar\frac{\partial }{\partial t}A_k\exp(\frac{\mathrm{i}}{\hbar}S_k)\\
\intertext{inserting definition of kinetic operator \ref{def:nuclearkinetic} and apply product rule for time derivative}
&\left[ \sum_I\frac{-\hbar^2}{2M_I}\nabla_I^2+E_{el}\right]A_k\exp(\frac{\mathrm{i}}{\hbar}S_k)=\mathrm{i}\hbar(\frac{\partial A_k}{\partial t}\exp(\frac{\mathrm{i}}{\hbar}S_k)+\frac{\partial S_k}{\partial t}A_k\exp(\frac{\mathrm{i}}{\hbar}S_k)\frac{\mathrm{i}}{\hbar})\\
\intertext{expand the laplace operator}
&\sum_I\frac{-\hbar^2}{2M_I}\left[ A_k\Delta_I\exp(\frac{\mathrm{i}}{\hbar}S_k)+2(\nabla_I\exp(\frac{\mathrm{i}}{\hbar}S_k))\cdot(\nabla_IA_k)+\exp(\frac{\mathrm{i}}{\hbar}S_k)\Delta_IA_k\right]\\
&+E_{el}A_k\exp(\frac{\mathrm{i}}{\hbar}S_k)=\mathrm{i}\hbar\frac{\partial A_k}{\partial t}\exp(\frac{\mathrm{i}}{\hbar}S_k)-\frac{\partial S_k}{\partial t}A_k\exp(\frac{\mathrm{i}}{\hbar}S_k)\\
\intertext{apply gradient rules to the exponential}
&\sum_I\frac{-\hbar^2}{2M_I}\left[ A_k\Delta_IS_k\exp(\frac{\mathrm{i}}{\hbar}S_k)\frac{-1}{\hbar^2}+2\nabla_IS_k\exp(\frac{\mathrm{i}}{\hbar}S_k))\frac{\mathrm{i}}{\hbar}\cdot(\nabla_IA_k)+\exp(\frac{\mathrm{i}}{\hbar}S_k)\Delta_IA_k\right]\\
&+E_{el}A_k\exp(\frac{\mathrm{i}}{\hbar}S_k)=\mathrm{i}\hbar\frac{\partial A_k}{\partial t}\exp(\frac{\mathrm{i}}{\hbar}S_k)-\frac{\partial S_k}{\partial t}A_k\exp(\frac{\mathrm{i}}{\hbar}S_k)\\
\intertext{the exponential can be cancelled out on each side}
&\sum_I\frac{-\hbar^2}{2M_I}\left[ A_k\Delta_IS_k\frac{-1}{\hbar^2}+2\nabla_IS_k\frac{\mathrm{i}}{\hbar}\cdot(\nabla_IA_k)+\Delta_IA_k\right]+E_{el}A_k=\mathrm{i}\hbar\frac{\partial A_k}{\partial t}-\frac{\partial S_k}{\partial t}A_k\\
\intertext{partition the sum to single terms and cancel factors}
&\sum_I\frac{1}{2M_I}A_k\Delta_IS_k+\sum_I\frac{-\mathrm{i}\hbar}{M_I}(\nabla_IS_k)\cdot(\nabla_IA_k)+\sum_I\frac{-\hbar^2}{2M_I}\Delta_IA_k+E_{el}A_k\\
&=\mathrm{i}\hbar\frac{\partial A_k}{\partial t}-\frac{\partial S_k}{\partial t}A_k\\
\intertext{a coefficient comparison yields the final equations}
&\implies\frac{\partial S_k}{\partial t} + \sum_I\frac{1}{2M_I}(\nabla_IS_k)^2+E_{el}=\hbar^2\sum_I\frac{1}{2M_I}\frac{\nabla_I^2A_k}{A_k} \\
&\implies\frac{\partial A_k}{\partial t}+\sum_I\frac{1}{M_I}(\nabla_IA_k)(\nabla_IS_k)+\sum_I\frac{1}{2M_I}A_k(\nabla_I^2S_k)=0
\end{align*}
whereas the equation for the amplitude multiplied by $2A_k$ is also known as a first continuity equation

\begin{align}
&\frac{\partial A_k^2}{\partial t}+\sum_I\frac{1}{M_I}\nabla_I(A_k^2\nabla_IS_k)=0
\intertext{and with the definition of a current density $\mathbf{J}_{k,I}=A_k^2(\nabla_IS_k)/M_I$ and using the probability density function $\rho_k=|\chi_k|^2 \equiv A_k^2$ a second continuity equation}
&\frac{\partial \rho_k}{\partial t}+\sum_I\nabla_I\mathbf{J}_{k,I}=0.
\end{align}


Note that these are independent of $\hbar$. More importantly for the classical limit $\hbar \to 0$ the equation for $S_k$ reduces to:
\begin{equation}
\frac{\partial S_k}{\partial t} + \sum_I\frac{1}{2M_I}(\nabla_IS_k)^2 + E_{el} = 0
\label{eq:classicallimitbo}
\end{equation}
which is equivalent to the Hamilton-Jacobian formulation of classical mechanics
\begin{align*}
&\frac{\partial S_k}{\partial t} + H_k(\{ \mathbf{R}_I \},\{ \nabla_IS_k \}) = 0
\intertext{with the classical Hamilton function}
&H_k(\{ \mathbf{R}_I \},\{\mathbf{P}_I  \}) =T(\{\mathbf{P}_I\})+V_k(\{ \mathbf{R}_I \})
\intertext{for a given conserved energy $d E_{k}^{tot} /dt =0$ and hence}
&\frac{\partial S_k}{\partial t} =-(T+E_{el,k})=-E_k^{tot}=const.
\intertext{defined in terms of generalized coordinates $\{ \mathbf{R}_I \}$ and their conjugate canonical momenta $\{ \mathbf{P}_I \}$. With the help of the connecting transformation}
&\mathbf{P}_I \equiv \nabla_IS_k \left[=M_I\frac{\mathbf{J}_{k,I}}{\rho_k} \right]
\end{align*}
the Newtonian equations of motion corresponding to $\ref{eq:classicallimitbo}$ can be read off
\begin{align}
&\frac{d \mathbf{P}_I}{dt} = -\nabla_IE_{el,k}\text{ or}\nonumber\\
&M_I\ddot{\mathbf{R}}_I = -\nabla_IV_k^{BO}(\{ \mathbf{R}_I\})\label{eq:eombo}
\end{align}
separately for each decoupled electronic state $k$. Thus, the nuclei move according to classical mechanics in an effective potential, $V_k^{BO}$ , which is given by the Born-Oppenheimer potential energy surface $E_k$ obtained by solving simultaneously the time-independent electronic Schrödinger equation for the $k$th state, \ref{eq:tiese}, at the given nuclear configuration $\{\mathbf{R}_I (t)\}$. Note that this result is based on ansatz \ref{ansatz:bo} and \ref{ansatz:pointparticle} but can be obtained directly when using the Lagrangian in \ref{lagrangian:BO}. The significant difference is that the Lagrangian was an educated guess whereas here it is physically motivated and derived.

Vice versa one can insert the point particle ansatz \ref{ansatz:pointparticle} into the TDSCF framework given in equations \ref{eq:tdscfnuclear} and \ref{eq:tdscfelectronic}. In this derivation for simplicity only one term for the $\Phi$ product was used.
\begin{align}
&\mathrm{i}\hbar \frac{\partial \chi}{\partial t} = \hat{T}_n\chi+  \Bra{\Phi} \hat{H}_{el}\Ket{\Phi} \chi\label{eq:tdesescfnuclei}\\
&\mathrm{i}\hbar \frac{\partial\Phi}{\partial t}= \hat{T}_e \Phi + \Bra{\chi} \hat{V}_{n-e} \Ket{\chi} \Phi\label{eq:tdesescfelectric}\\
\intertext{inserting ansatz \ref{ansatz:pointparticle}}
&\mathrm{i}\hbar \frac{\partial A\exp(\frac{\mathrm{i}}{\hbar}S)}{\partial t} = \hat{T}_nA\exp(\frac{\mathrm{i}}{\hbar}S)+  \Bra{\Phi} \hat{H}_{el}\Ket{\Phi} A\exp(\frac{\mathrm{i}}{\hbar}S)\nonumber\\
\intertext{inserting definitions of kinetic operator \ref{def:nuclearkinetic}}
&\mathrm{i}\hbar \frac{\partial A\exp(\frac{\mathrm{i}}{\hbar}S)}{\partial t} = \sum_I \frac{-\hbar^2}{2M_I}\nabla_I^2 A\exp(\frac{\mathrm{i}}{\hbar}S)+  \Bra{\Phi} \hat{H}_{el}\Ket{\Phi} A\exp(\frac{\mathrm{i}}{\hbar}S)\nonumber\\
\intertext{the same reformulation as before can be used}
&\mathrm{i}\hbar\frac{\partial A}{\partial t}-\frac{\partial S}{\partial t}A=\sum_I\frac{1}{2M_I}A\Delta_IS+\sum_I\frac{-\mathrm{i}\hbar}{M_I}(\nabla_IS)\cdot(\nabla_IA)\nonumber\\
&+\sum_I\frac{-\hbar^2}{2M_I}\Delta_IA+\Bra{\Phi} \hat{H}_{el}\Ket{\Phi} A\nonumber\\
&\implies\frac{\partial S}{\partial t} + \sum_I\frac{1}{2M_I}(\nabla_IS)^2+\Bra{\Phi} \hat{H}_{el}\Ket{\Phi}=\hbar^2\sum_I\frac{1}{2M_I}\frac{\nabla_I^2A}{A}\nonumber\\
&\implies\frac{\partial A}{\partial t}+\sum_I\frac{1}{M_I}(\nabla_IA)(\nabla_IS)+\sum_I\frac{1}{2M_I}A(\nabla_I^2S)=0\nonumber
\end{align}
Note the difference that here no electronic states $k$ are used and in the classical limit $\hbar \to 0$
\begin{equation}
\frac{\partial S}{\partial t} + \sum_I\frac{1}{2M_I}(\nabla_IS)^2+\Bra{\Phi} \hat{H}_{el}\Ket{\Phi}=0
\label{eq:classicallimitscf}
\end{equation}
Correspondingly, the Newtonian equations of motion equivalent to \ref{eq:classicallimitscf} are given by
\begin{align}
&\frac{d \mathbf{P}_I}{dt} = -\nabla_I\Bra{\Phi} \hat{H}_{el}\Ket{\Phi}\text{ or}\nonumber\\
&M_I\ddot{\mathbf{R}}_I = -\nabla_IV_e^{E}(\{ \mathbf{R}_I\})\label{eq:eomscf}
\end{align}
Here, the nuclei move according to classical mechanics in an effective potential $V_e^{E}$, often called the Ehrenfest potential, which is given by the quantum dynamics of electrons obtained by solving simultaneously the time-dependent electronic Schr\"odinger equation \ref{eq:tdesescfelectric}. Note that this interaction potential due to explicit time evolution of the quantum electrons stems from averaging the electronic Hamiltonian with respect to electronic degrees of freedom $V_e^{E} = \Bra{\Psi}\hat{H}_{el}\Ket{\Psi}$. However equation \ref{eq:tdesescfelectric} still includes the full quantum-mechanical nuclear wavefunction $\chi(\{\mathbf{R}_I\};t)$ instead of just the classical-mechanical nuclear positions $\{\mathbf{R}_I\}$. This can be reduced in the classical limit $\hbar \to 0$, because the nuclear density function $|\chi(\{\mathbf{R}_I\};t)|^2$ in equation \ref{eq:tdesescfelectric} can be rewritten as a product of delta functions $\prod_I\delta(\mathbf{R}_I -\mathbf{R}_I(t))$ centered at the instantaneous positions $\{\mathbf{R}_I\}$ of the classical nuclei. Hence,
\begin{align*}
\int_{}^{} \chi^*(\{\mathbf{R}_I\};t) \mathbf{R}_I \chi(\{\mathbf{R}_I\};t)d\mathbf{R} \xrightarrow[]{\hbar \to 0} \mathbf{R}_I(t)
\intertext{and therefore}
\mathrm{i}\hbar \frac{\partial\Phi}{\partial t}= -\sum_i\frac{\hbar^2}{2m_e}\nabla_i^2 \Phi + \hat{V}_{n-e}(\{\mathbf{r}_i\},\{\mathbf{R}_I(t)\})\Phi\\
=\hat{H}_{el}(\{\mathbf{r}_i\},\{\mathbf{R}_I(t)\})\Phi(\{\mathbf{r}_i\},\{\mathbf{R}_I\};t)
\end{align*}
This means that feedback between the classical and quantum degrees of freedom is incorporated in both directions, although in a mean-field sense only. This approach is often called "Ehrenfest molecular dynamics" in honor of Paul Ehrenfest who was the first to address the essential question of how Newtonian classical dynamics of point particles can be derived from Schr\"odiner's time-dependent wave equation \cite{ehrenfest1927bemerkung}.

\subsection{Recovering BOMD from EhrenfestMD}
One can transform Ehrenfest molecular dynamics by introducing a again basis into the electronic wavefunction. This basis has to be of the following form:
\begin{align*}
\Phi(\{ \mathbf{r}_i\},\{ \mathbf{R}_I\};t ) = \sum_{l=0}^{\infty} c_l(t)\Phi_l(\{ \mathbf{r}_i\};\{ \mathbf{R}_I\})
\end{align*}
with complex time-dependent coefficients $\{ c_l(t)\}$ which describe the time evolution of occupations of different states $l$. One possible choice for the basis functions is again the adiabatic basis obtained by solving the time-independent Schr\"odinger equation. Furthermore the electronic adiabatic basis is restricted to the ground state $\Psi_{el,0}$ at each instant of time. This should be a good approximation as long as the difference between $\Psi_{el,0}$ and $\Psi_{el,1}$ is larger than $k_bT$ roughly speaking. Then the potential can be written as:
\begin{equation}
V_e^{E} = \int_{}^{} \Psi_{el,0}^*\hat{H}_{el}\Psi_{el,0}d \mathbf{r} \equiv E_0(\{\mathbf{R}_I\})
\end{equation}
which is equivalent to $V_0^{BO}(\{\mathbf{R}_I\})$.

\subsection{Recapitulation}
Until now it was shown a structural derivation of two different ways to derive equations for a molecular dynamics simulation. Both are valid under their underlying assumptions and one could reproduce Born-Oppenheimer from Ehrenfest as shown. Both methods in the end need an underlying potential and orbital functions. These are acquired through different methods depending on the Hamiltonian. A possible way is to use the well-known method developed by Hartree Fock and Slater. Alternatively one could also use the method further developed by Rothaan and Hall \cite{roothaan1951new}. A complete different framework much later developed is the density functional theory which could also be used for calculation. In this framework the well-known Kohn-Sham equations \cite{kohn1965self} could be used to calculate the orbital functions and energies. Indifferent from the chosen method there will be a bottleneck in the calculation because physically electrons and their orbital functions have no "brain", meaning the state of the current timestep is independent of the previous timestep. This leads to a repetitive calculation of electronic orbitals in each timestep which causes a computational bottleneck.

\section{Introducing Artificiality}
One could significantly decrease the computational cost when one uses the orbitals from the previous timestep. This could be done in the following way numerically:
\begin{align*}
\phi_{t+1,m} &= \phi_{t,m} + \delta\phi_{m}
\intertext{as a consequence one also has created a numerical velocity}
\dot{\phi_{m}}&\approx \frac{\phi_{t+1,m}-\phi_{t,m}}{\Delta t} = \frac{\delta\phi_m}{\Delta t}
\intertext{note that this a different contribution in comparison to the electronic kinetic energy used in solving the Schr\"odinger equation in the beginning.}
\hat{T}_{e}\phi&=\sum_i\frac{-\hbar^2}{2m_e}\nabla_i^2\phi
\end{align*}
Now the electronic wavefunctions use the previous state with a small perturbation as a starting point for the next timestep. This means at the beginning the equations are solved exactly once so the starting point is the correct orbitals. This allows for example faster convergence in the self-consistent field method to the next set of orbitals for a new configuration $\{\mathbf{R}_I\}$. However since the electronic orbitals also have a numerical velocity they provide a artificial contribution to the kinetic energy. This leads to a possible extension of the already discussed molecular dynamics simulations. One famous thereof is Car-Parinello molecular dynamics \cite{car1985unified} which uses Kohn-Sham equations and a plane wave basis ansatz. We know the artificial velocity and thus can introduce it into the Lagrangian framework. Therefore the Lagrangian of Car-Parinello molecular dynamics mentioned in other articles, e.g. \cite{tangney2002well} \cite{hutter2012car}, takes the following form:
\begin{equation}
\mathcal{L}^{CP} = \sum_i \mu_i \Braket{\dot{\phi_i}|\dot{\phi_i}} + \sum_I\frac{1}{2M_I}\dot{\mathbf{R}}_I - \mathcal{E}^{KS}(\{ \phi_i\},\{ \mathbf{R}_I\})
\end{equation}
where $\mathcal{E}$ is the Kohn-Sham energy functional and $\mu_i$ the fictitious mass. The mass has the role of keeping the numerical kinetic energy strictly small such that it is negligible in comparison to the nuclear kinetic energy. It is of no surprise that this idea produced a lot of controversy. The reason thereof lies in the fact that one left the pure physical motivated world. For example when only doing Born-Oppenheimer molecular dynamics the energy differences calculated through such an approach can be matched with physical data from nano-spectroscopy or other types of measurements and therefore the simulation has physical meaning. This is no longer guaranteed in Car-Parinello molecular dynamics because non existing energy was introduced. One can only extract meaning under the assumption that $\mu$ is well chosen in a sense that the inaccuracy vanishes which then leads to the correct energy differences.
Furthermore to keep the orbitals orthogonal in time the Lagrange multipliers are used in each timestep which increases the number of computation additionally but it is small in comparison from a full self-consistent field calculation. Furthermore one has to be careful because like in \cite{tangney2006theory} described there could be lost more due to artifacts created through such an approach than gained in computational speed. The main point is that one introduces new degrees of freedom, $\mu_i$ included, which increases the complexity of the problem but as a trade-off reduces computational time. The question how to choose $\mu_i$ correctly is dependent on the problem itself, meaning it could differ depending on the type of atoms and molecules one wants to simulate. The idea of orbital perturbation can also be introduced into the Born-Oppenheimer framework seen as in \cite{niklasson2009extended}.

\section{Complete Picture}
%As a summary and overview a complete picture is presented.
\newpage
\begin{landscape}
\begin{figure}
\includegraphics[scale=1.0]{tikz.pdf}
\end{figure}
%\includestandalone{tikz}
\end{landscape}
\newpage

\section{Conclusion}
As one can see the development of new molecular dynamic techniques never ended since they still come up with new ideas and through new computers with better performance more methods get feasible. For example in \cite{pulay2004fock} instead of propagating orbitals they propagate the Fock matrix directly. One should not forget that in all these methods there is an underlying choice of basis for orbitals. There are Gauss type orbitals(GTO), atomic type orbitals(ATO) or one could use a plane wave basis to name just a few. This choice not only influences the speed of the computation but also which properties can be extracted from the simulation. Further depending on the application different methods are preferred. For example simulating a solid system a different method is chosen in comparison to simulate a fluid or gas. In the end no molecular dynamics program can be perfect thus in different fields different choices and experiences are made. In conclusion Car-Parinello molecular dynamics is a viable option when the underlying system does not change significantly under the influence of an artificial kinetic energy.

\nocite{marx2009ab} %wichtigstes BUCH
\nocite{payne1992iterative} %iterative minimization techniques for ab inito
\nocite{pulay2004fock} %fock matrix dynamics
\nocite{fischer1987general} %fock method

\newpage
\bibliographystyle{plain}
\bibliography{references}


\end{document}
